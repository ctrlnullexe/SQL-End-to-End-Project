/*
=====================================================================================
 Script: init_database
 Purpose:
   Initializes the Data Warehouse environment by creating a fresh DWH database
   along with its logical data layers (bronze, silver, gold).

 Behavior:
   * Checks if the 'DWH' database already exists
   * Forces single-user mode to safely terminate active connections
   * Drops and recreates the database to ensure a clean, repeatable setup

 Design Notes:
   * Intended for development and learning environments
   * Destructive operation â€” ALL existing data will be lost
   * Follows the Medallion Architecture pattern:
       - bronze : raw, unprocessed source data
       - silver : cleaned, standardized, validated data
       - gold   : analytics-ready, business-level aggregates
=====================================================================================
*/

USE master;
GO

-- Drop and recreate the 'DWH' database if it already exists
IF EXISTS (SELECT 1 FROM sys.databases WHERE name = 'DWH')
BEGIN
    -- Force single-user mode to terminate active sessions before dropping
    ALTER DATABASE DWH SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
    DROP DATABASE DWH;
END;
GO

-- Create the 'DWH' database
CREATE DATABASE DWH;
GO

-- Switch context to the newly created database
USE DWH;
GO

-- Create schemas representing each layer of the data warehouse
CREATE SCHEMA bronze;
GO

CREATE SCHEMA silver;
GO

CREATE SCHEMA gold;
GO
